---
### Setup a Nginx web server, displaying a 'hello world' page on a specific URI
# > ansible-playbook -i hostsWithCustomSSHPort 10-forge-a-nginx-stack.yml

# Example & boilerplate to start a container with security & reverse proxy

### Docker required services setup
# Traefik / Reverse proxy


# You'll need the_builder_guy to have it's ssh key added to the local agent, cf. the_builder_guy generated documentation
# You'll need the_docker_guy  to have it's ssh key added to the local agent, cf. the_docker_guy  generated documentation

### builder_guy
- name: '{{ users.0.name }} / Test / Web / Nginx / Generate or update config files and upload them'
  become: yes
  hosts: likorneWithCustomSSHPort
  # the_builder_guy / cf. /ansible/roles/users/vars/main.yml
  remote_user: '{{ users.0.name }}'
  vars:
    currentDateTime: "{{ lookup('pipe', 'date +%Y-%m-%d--%Hh%Mm%Ss') }}"
  vars_files:
  - defaults/main.yml
  - vars/main.yml
  - roles/users/defaults/main.yml
  - roles/users/vars/main.yml

  roles:
    - stack-web-nginx--config


### builder_guy
- name: '{{ users.0.name }} / Test / Web / Nginx / Generate or update stack .yml files and upload them'
  become: yes
  hosts: likorneWithCustomSSHPort
  # the_builder_guy / cf. /ansible/roles/users/vars/main.yml
  remote_user: '{{ users.0.name }}'
  vars:
    currentDateTime: "{{ lookup('pipe', 'date +%Y-%m-%d--%Hh%Mm%Ss') }}"
  vars_files:
  - defaults/main.yml
  - vars/main.yml
  - roles/users/defaults/main.yml
  - roles/users/vars/main.yml

  roles:
    - stack-web-nginx--generate

### docker_guy
- name: '{{ users.2.name }} / Test / Web / Nginx / Setup networks & volumes then start or update stack'
  become: no
  hosts: likorneWithCustomSSHPort

  # the_docker_guy / cf. /ansible/roles/users/vars/main.yml
  remote_user: '{{ users.2.name }}'
  vars_files:
  - defaults/main.yml
  - roles/users/defaults/main.yml
  - vars/main.yml
  - roles/users/vars/main.yml

  roles:
    - stack-web-nginx--run
...