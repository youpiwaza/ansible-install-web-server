---
### Generate or update a Nginx playbook
## builder_guy
# > ansible-playbook -i hostsWithCustomSSHPort 10-forge-a-nginx-playbook.yml

# üí°How to use: Set variables in a dedicated file, and run this playbook to generate a nginx playbook dedicated to one site
#   Run the newly created playbook to generate, upload & deploy the .yml stack file.

# üìåYou can test this playbook by running it without modifications
# > ansible-playbook -i hostsWithCustomSSHPort 10-forge-a-nginx-playbook.yml
# It will generate the example
#     'ansible/100-forge---hello--masamune--fr---nginx-stack.yml'
#   sourced by the example var files
#     'roles/stack-web-nginx--generate-playbook/vars/tests/masamune/hello--masamune--fr/hello--masamune--fr---vars.yml'

# üßæStep-by-step How to:
# 1. Duplicate 'ansible/roles/stack-web-nginx--generate-playbook/vars/template.yml' to a proper location
#                                             Add '_secret' suffix to add this sensible file to .gitignore vv
#    like 'ansible/roles/stack-web-nginx--generate-playbook/vars/TYPE/CLIENT/DASHED-URI/DASHED-URI---vars_secret.yml' (which will be üîß vars_file_path)
# 1.1. Edit your file according to your needs
#      Adjust project.vars_file_path  to reflect the path from step 1. See the üîß around line ~30
# 2. Edit '10-forge-a-nginx-playbook.yml' to use your vars file,see the ‚úèÔ∏è around line ~51
# 3. Run/Test your playbook: ~> ansible-playbook -i hostsWithCustomSSHPort 10-forge-a-nginx-playbook.yml
#    You can check the generated playbook file at the root folder 10X-forge---DASHED-URI---nginx-stack-generated.yml
# 4. Make backup to a private github repository if everything runs smoothly, and save..
# 4.1 ansible/roles/stack-web-nginx--generate-playbook/vars/TYPE/CLIENT/DASHED-URI/DASHED-URI---vars_secret.yml
# 4.2 History / ansible/roles/stack-web-nginx--generate-playbook/vars/TYPE/CLIENT/DASHED-URI/DASHED-URI---vars-{{ currentDateTime }}.yml
# 4.3 Add 10X-forge---DASHED-URI---nginx-stack-generated.yml
# 4.4 History / 10X-forge---DASHED-URI---nginx-stack-generated-{{ currentDateTime }}.yml

# üå±TODO:
#  - Generate playbooks: stop stack, uninstall stack (rm volumes), save volumes

# You'll need the_builder_guy to have it's ssh key added to the local agent, cf. the_builder_guy generated documentation

## builder_guy
- name: Generate or update a Nginx playbook
  become: yes
  hosts: likorneWithCustomSSHPort
  # builder_guy / cf. /ansible/roles/users/vars/main.yml
  remote_user: '{{ users.0.name }}'
  vars:
    currentDateTime: "{{ lookup('pipe', 'date +%Y-%m-%d--%Hh%Mm%Ss') }}"
  vars_files:
  - defaults/main.yml
  - roles/users/defaults/main.yml
  - vars/main.yml
  - roles/users/vars/main.yml
  # ‚úèÔ∏èEdit project vars files here...
  # - roles/stack-web-nginx--generate-playbook/vars/TYPE/CLIENT/DASHED-URI/DASHED-URI---vars_secret.yml
  - roles/stack-web-nginx--generate-playbook/vars/tests/masamune/hello--masamune--fr/hello--masamune--fr---vars.yml

  roles:
    - stack-web-nginx--generate-playbook
...